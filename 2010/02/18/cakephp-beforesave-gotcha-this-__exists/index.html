<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta name="generator" content="Hugo 0.20.7" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> CakePHP beforeSave() gotcha: need to set $this-&gt;__exists to true if setting a primary key </title>

     
      
    
    
    
    
    

  <meta name="author" content="alan">

 
    <meta property="og:title" content="CakePHP beforeSave() gotcha: need to set $this-&gt;__exists to true if setting a primary key" />
<meta property="og:description" content="I added an update to CakePHP Book: beforeSave()
 Also, if you add a primary key which would turn an &#8220;insert&#8221; into an &#8220;update&#8221; within beforeSave() you&#8217;ll need to set $this-&gt;__exists = true;&#8230; the call to $this-&gt;exists(); happens in model.php before the callback to beforeSave().
function beforeSave() { if (!isset($this-&gt;data[$this-&gt;name][&#39;id&#39;]) && isset($this-&gt;data[$this-&gt;name][&#39;unique_field&#39;])) { $found = $this-&gt;find(&#34;first&#34;,array( &#34;recursive&#34; =&gt; -1, &#34;fields&#34; =&gt; array(&#34;id&#34;), &#34;conditions&#34; =&gt; array(&#34;unique_field&#34; =&gt; $this-&gt;data[$this-&gt;name][&#39;unique_field&#39;]))); if (!empty($found) && isset($found[$this-&gt;name][&#39;id&#39;])) { $this-&gt;id = $this-&gt;data[$this-&gt;name][&#39;id&#39;] = $found[$this-&gt;name][&#39;id&#39;]; $this-&gt;__exists = true; } } return parent::beforeSave(); }  That&#8217;s been confusing me a bit recently &#8211; setting the ID of a row within beforesave() should change the save to an update, but it was trying to insert with a specified ID and thus, failing&#8230; glad to have a simple solution that makes sense&#8230; hope that helps someone else&#8230;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zeroasterisk.com/2010/02/18/cakephp-beforesave-gotcha-this-__exists/" />



<meta property="article:published_time" content="2010-02-19T02:59:45&#43;00:00"/>
<meta property="article:modified_time" content="2010-02-19T02:59:45&#43;00:00"/>










 
    



  <meta property="og:image" content="https://en.gravatar.com/userimage/831761/080d157cba7201fa2d89172617f6b7bb.jpg?size=200">

 
    
     
     
    
    
    <link rel="canonical" href="https://zeroasterisk.com/2010/02/18/cakephp-beforesave-gotcha-this-__exists/">   <link rel="shortcut icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABwlBMVEUAAAA/3MUK07UJ0rRk6NkC0rMAw5sAx6Ic1rs/3MYAlU0E0rQAhjMAyKIAiTkM07UJ07UAhC8m2L4o2L5O4Msn2L4AzKoAzq0128Mo2b8F0rQE0rMu2cAt2cAA0bI228MA0LAAy6kr2b8Q1LcF0rMH0rUAxp4t2b8c1ros2b8P1LcAzKsAzq4528Q02sIM07YAfyg93cUD0rMA0LEA0bFK4c0M1LcL07Uv2sEAzawY1rlJ4c0w2sEAzKkY1rqr+PQN07Yj170G0rQI07UF0bMt2cAF0rMC0bIL07UF0bMs2cAF0rMA0bIC0bIL07UF0rMA0bIA0bIA0bIO1LYr2b8N07Yp2L4F0rMF0rQJ07UA0bIC0bMA0bIH0rQK07UD0bMA0LAF0rMAyqYE0rMA0bIS1Lg228ID0bMM07YS1LcI07QL07UJ07UC0bMM07YG0rMS1Lc328IR1LcC0bIK07UM07Yo2L4P1LcL07UD0rMD0rMD0rMB0bIH0rQ23MMQ1LcD0rMN1LYB0LAJ0rQ33MMG0bMP1bgD0rMN07YH0rQH0rQ33MQF0rMD0rMN1LYo2L4F0rQG0rSA6tsA0bIB0bL////yxqscAAAAk3RSTlMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgnDXAUItvZKBAi6+vpMuf3++wEIAQcEBFn5AgR9UwMEoQLD/AEH4AIdAzha+UMEAQcc9AM4CAFSA9IC+4AEAc8yAwIEBAHOMQOBBLfLMAnFlAJNsa0LAAAAAWJLR0SVCGB6gwAAAAd0SU1FB+EBBBI4BduZ4woAAAF5SURBVDjLY2CAAUYmZgcWRydnVhc2dg4GTMAJlOdydZvs7sHtiU0FSJ7Hy3uyz2RfP24XNl4OLPJ8Xv5A+YBAsAo0M2DyQZMnY1fBL+AgCJXHrkIoWDgEJo9NhUioaBhCHqoiXExcAqZAMkIqckrU5MkoKqSjZeAmyMbIxSIZAFIRMCVOOl4epkAmQSERrwKOJMXkySl4rEhVSkufHDAZtyMzlDPdJweiyiN7UyRLIHsKQj5wMnowSIar5ExJQcjn5qnmqyFHlzqKL7EoQPMlphUaaL7EcGSBZiGKLzFUZGgVFSP5ElNFCVPpFORwhAeVto4uWEGwUJk3alSAVXhIR+tB7ShHTi5QkOIzpUKqEmKCPpODgReaipSUyVWl0tW6GEkWGhRBk2tq6wzrsSVqqPaGRqOmZmMTXWwqwNpbTFvbzMwtsGUMoPb2DqOmTksxK2xZLyhgck1XtzVIuw22zNszeXJvH0i7rR1G9gVlf/v+CRMnWaPYDgA74gwO0j2znAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wMS0wNFQxODo1NjowNSswMTowME2yC4wAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDEtMDRUMTg6NTY6MDUrMDE6MDA877MwAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> 
    <link rel="stylesheet" href="https://jenil.github.io/bulmaswatch/flatly/bulmaswatch.min.css"> 
    <link rel="stylesheet" href="https://zeroasterisk.com/css/landing.css"> 
<link rel="stylesheet" href="https://zeroasterisk.com/css/blog-post.css"> 
<link rel="stylesheet" href="https://zeroasterisk.com/css/code-highlighting/dark.css">
<link rel="stylesheet" href="https://zeroasterisk.com/css/custom.css"> 
 
    
    
</head>


<body>
    <header> <nav class="nav has-shadow">
<div class="nav-left">
    <a class="nav-item" href="https://zeroasterisk.com/">
        <img src="https://zeroasterisk.com/img/logo-zeroasterisk-on-blue.png" alt="Zeroasterisk | Alan Blount">
    </a>
</div>

<div class="nav-center">
    

    <a class="nav-item" target="blank" href="https://github.com/zeroasterisk">
        <span class="icon">
            <i class="fa fa-github"></i>
          </span>
    </a>
    
    

    <a class="nav-item" target="blank" href="https://twitter.com/zeroasterisk">
        <span class="icon">
            <i class="fa fa-twitter"></i>
          </span>
    </a>
    
</div>



<span class="nav-toggle">
        <span></span>
<span></span>
<span></span>
</span>



<div class="nav-right nav-menu" itemscope itemtype="http://schema.org/SiteNavigationElement">
        
        
        <a itemprop="url" class="nav-item is-tab " href="https://zeroasterisk.com/alan/"><span itemprop="name">Alans</span></a>
        
        <a itemprop="url" class="nav-item is-tab  is-active" href="https://zeroasterisk.com/post/"><span itemprop="name">Posts</span></a>
        
</div>
</nav>
 </header>
    <main>

<div class="container" itemscope itemtype="http://schema.org/BlogPosting">
     
<meta itemprop="name" content="CakePHP beforeSave() gotcha: need to set $this-&gt;__exists to true if setting a primary key">
<meta itemprop="description" content="I added an update to CakePHP Book: beforeSave()
 Also, if you add a primary key which would turn an &#8220;insert&#8221; into an &#8220;update&#8221; within beforeSave() you&#8217;ll need to set $this-&gt;__exists = true;&#8230; the call to $this-&gt;exists(); happens in model.php before the callback to beforeSave().
function beforeSave() { if (!isset($this-&gt;data[$this-&gt;name][&#39;id&#39;]) && isset($this-&gt;data[$this-&gt;name][&#39;unique_field&#39;])) { $found = $this-&gt;find(&#34;first&#34;,array( &#34;recursive&#34; =&gt; -1, &#34;fields&#34; =&gt; array(&#34;id&#34;), &#34;conditions&#34; =&gt; array(&#34;unique_field&#34; =&gt; $this-&gt;data[$this-&gt;name][&#39;unique_field&#39;]))); if (!empty($found) && isset($found[$this-&gt;name][&#39;id&#39;])) { $this-&gt;id = $this-&gt;data[$this-&gt;name][&#39;id&#39;] = $found[$this-&gt;name][&#39;id&#39;]; $this-&gt;__exists = true; } } return parent::beforeSave(); }  That&#8217;s been confusing me a bit recently &#8211; setting the ID of a row within beforesave() should change the save to an update, but it was trying to insert with a specified ID and thus, failing&#8230; glad to have a simple solution that makes sense&#8230; hope that helps someone else&#8230;">


<meta itemprop="dateModified" content="2010-02-19T02:59:45&#43;00:00" />
<meta itemprop="wordCount" content="134">



<meta itemprop="keywords" content="adobe-connect,alan,anita,art,cakephp,cordova-/-phonegap,development,event/news,friends-blogs,geek,general,japan,js,laughable,learning-developers,linux,look-at-this,meteorjs,oliver,penelope,php,political,pregnancy,thoughts,beforesave,birth,cake,cakephp,california,childbirth,code,cron,docker,doula,family,geek,git,github,google,google-apps,google-docs,heal,home-birth,internet-explorer-6,linux,master,midwifery,monitor,mysql,new-developers,oliver,open-source,php,poppy,programming,replication,slave,sonoma,tech-web,test,test-heal,vacation,vacation-wedding,wedding," />

    <section class="hero is-primary is-medium">
        <div class="hero-body">
            <div class="container has-text-centered">
                <h1 class="title is-2" itemprop="headline">
                    CakePHP beforeSave() gotcha: need to set $this-&gt;__exists to true if setting a primary key
                </h1>
                
            </div>
        </div>
    </section>
    <section class="section blog">
        <div class="container">
            <p><span class="icon">
  <i class="fa fa-clock-o" aria-hidden="true"></i>
</span>
<span>1 minute read</span>
<span class="icon">
 <i class="fa fa-pencil" aria-hidden="true"></i>
</span>

  Published: <time datetime="2010-02-19T02:59:45&#43;00:00">19 Feb, 2010</time>

</p>
            <div class="columns is-mobile">
                <div class="column">

                    <div class="content blog-post section" itemprop="articleBody">

                        
                        <hr>
                        <p>I added an update to <a href="http://book.cakephp.org/view/76/Callback-Methods">CakePHP Book: beforeSave()</a></p>

<blockquote>
<p>Also, if you add a primary key which would turn an &#8220;insert&#8221; into an &#8220;update&#8221; within beforeSave() you&#8217;ll need to set <code>$this-&gt;__exists = true;</code>&#8230; the call to <a href="http://api12.cakephp.org/view_source/model/#line-1159">$this-&gt;exists();</a> happens in model.php before the callback to <a href="http://api12.cakephp.org/view_source/model/#line-1191">beforeSave()</a>.</p>

<pre>function beforeSave() {
    if (!isset($this-&gt;data[$this-&gt;name]['id']) && isset($this-&gt;data[$this-&gt;name]['unique_field'])) {
        $found = $this-&gt;find("first",array(
                "recursive" =&gt; -1,
                "fields" =&gt; array("id"),
                "conditions" =&gt; array("unique_field" =&gt; $this-&gt;data[$this-&gt;name]['unique_field'])));
        if (!empty($found) && isset($found[$this-&gt;name]['id'])) {
            $this-&gt;id = $this-&gt;data[$this-&gt;name]['id'] = $found[$this-&gt;name]['id'];
            <strong>$this-&gt;__exists = true;</strong>
        }
    }
    return parent::beforeSave();
}</pre>
</blockquote>

<p>That&#8217;s been confusing me a bit recently &#8211; setting the ID of a row within beforesave() should change the save to an update, but it was trying to insert with a specified ID and thus, failing&#8230; glad to have a simple solution that makes sense&#8230; hope that helps someone else&#8230;</p>

<div class="twttr_button">
  <a href="http://twitter.com/share?url=https://zeroasterisk.com/2010/02/18/cakephp-beforesave-gotcha-this-__exists/&text=CakePHP+beforeSave%28%29+gotcha%3A+need+to+set+%24this-%3E__exists+to+true+if+setting+a+primary+key" target="_blank" title="Click here if you like this article."> <img src="http://zeroasterisk.com/wp-content/plugins/twitter-plugin/images/twitt.gif" alt="Twitt" /> </a>
</div>

                    </div>
                    <div class="title is-4">
                        <p>
  Published
  
    
      by <span itemprop="author">alan</span>
    
  
  <time datetime="2010-02-19T02:59:45&#43;00:00">
    19 Feb, 2010
  </time>
  
    in <span itemprop="articleSection"><a href="https://zeroasterisk.com/categories/cakephp/">cakephp</a>, <a href="https://zeroasterisk.com/categories/development/">development</a> and <a href="https://zeroasterisk.com/categories/php/">php</a></span>
  
  
    and tagged <a href="https://zeroasterisk.com/tags/beforesave/">beforeSave</a>, <a href="https://zeroasterisk.com/tags/cake/">cake</a>, <a href="https://zeroasterisk.com/tags/cakephp/">cakephp</a> and <a href="https://zeroasterisk.com/tags/php/">php</a>
  
  using <span itemprop="wordCount">134</span> words.
</p>

                        
  



  <aside>
    <heade><strong>Related Content</strong></header>
    <hr>
    <ul>
      
      
        <li><a href="https://zeroasterisk.com/2010/01/13/mysql-masterslave-replication-monitoring-php-script/">MySQL Master/Slave Replication Monitoring PHP Script</a> &ndash; 1 minutes
      
    </ul>
  </aside>


                    </div>
          
                    
            
                </div>
            </div>
        
        </div>
    </section>
</div>

</main>
    <footer> 
<footer class="footer">
    <div class="container">
        <div class="content has-text-centered">
            <p>
              &copy;
              <a rel="noopener" href="https://alanblount.com/">
                Alan Blount
              </a>
              &middot;
              For more nerdy stuff checkout
              <a rel="noopener" href="https://code.zeroasterisk.com/">code.zeroasterisk.com</a>
              <em class="muted">~</em>
              <a target="_blank" rel="noopener" href="https://github.com/zeroasterisk/">
                <i class="fa fa-github"></i>
              </a>
            </p>
        </div>
    </div>
</footer>


 </footer>

    <script async type="text/javascript" src="https://zeroasterisk.com/js/bulma.js"></script>
    <script async type="text/javascript"  src="https://zeroasterisk.com/js/clipboard.min.js"></script>
    <script async type="text/javascript"  src="https://zeroasterisk.com/js/clip.js"></script>
</body>

</html>